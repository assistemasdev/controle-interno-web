import api from "../services/api";
import handleError from "../utils/errorHandler"; 
import qs from 'qs';
import { buildDynamicFilters } from "../utils/filterUtils";

const UnitService = {
    async getAll (data,navigate) {
        const query = qs.stringify({
            filters: buildDynamicFilters(data),
            page:data.page, 
            perPage: data.perPage
        }, { encode: false });
        try {
            const response = await api.get(`/units/?${query}`);
            return {
                message: response.data.message,
                result: response.data.result,
                status: response.status
            };
        } catch (error) {
            return handleError(error, navigate); 
        }
    },

    async getAllOutputUnits (id, data,navigate) {
        try {
            const response = await api.get(`/units/${id}/units/`, {params: {page:data.page, perPage: data.perPage}});
            return {
                message: response.data.message,
                result: response.data.result,
                status: response.status
            };
        } catch (error) {
            return handleError(error, navigate); 
        }
    },

    async create(data, navigate) {
        try {
            const response = await api.post("/units", data);
            return {
                message: response.data.message,
                result: response.data.result,
                status: response.status
            };
        } catch (error) {
            return handleError(error, navigate)
        }
    },

    async getById(id, navigate) {
        try {
            const response = await api.get(`/units/${id}`);
            return {
                message: response.data.message,
                result: response.data.result,
                status: response.status
            };
        } catch (error) {
            return handleError(error, navigate); 
        }
    },

    async update(id, data, navigate) {
        try {
            const response = await api.put(`/units/${id}`, data);
            return {
                message: response.data.message,
                result: response.data.result,
                status: response.status
            };
        } catch (error) {
            return handleError(error, navigate)
        }
    },

    async delete(id, navigate) {
        try {
            const response = await api.delete(`/units/${id}`);
            return {
                message: response.data.message,
                result: response.data.result,
                status: response.status
            };
        } catch (error) {
            return handleError(error, navigate)
        }
    },

    async allOutputUnits(id, navigate) {
        try {
            const response = await api.get(`/units/${id}/units`);
            return {
                message: response.data.message,
                result: response.data.result,
                status: response.status
            };
        } catch (error) {
            return handleError(error, navigate)
        }
    },
    async syncOutputUnits(id, data, navigate) {
        try {
            const response = await api.post(`/units/${id}/units`, data);
            return {
                message: response.data.message,
                result: response.data.result,
                status: response.status
            };
        } catch (error) {
            return handleError(error, navigate)
        }
    },
    async detachOutputUnits(id, data, navigate) {
        try {
            const response = await api.put(`/units/${id}/units`, data);
            return {
                message: response.data.message,
                result: response.data.result,
                status: response.status
            };
        } catch (error) {
            return handleError(error, navigate)
        }
    }
};

export default UnitService;
